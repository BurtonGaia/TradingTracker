<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Boursier Moderne</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 15px;
      background: #f0f2f5;
      transition: background 0.3s, color 0.3s;
      font-size: 16px; /* Base pour lisibilité mobile */
    }
    body.dark {
      background: #1a1a1a;
      color: #fff;
    }
    h1 {
      text-align: center;
      color: #333;
      font-size: 1.5em; /* Adapté pour mobile */
      margin-bottom: 15px;
    }
    .dark h1 { color: #fff; }
    .input-container {
      display: flex;
      flex-wrap: wrap; /* Passe en colonne sur petits écrans */
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1em;
      width: 100%; /* Pleine largeur sur mobile */
      max-width: 200px;
      transition: border-color 0.3s;
    }
    input:focus {
      border-color: #007bff;
      outline: none;
    }
    button {
      padding: 12px 20px; /* Plus grand pour le tactile */
      background: linear-gradient(45deg, #007bff, #00d4ff);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s;
      font-size: 1em;
    }
    button:hover {
      transform: scale(1.05);
    }
    .stock-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adapté pour mobile */
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .stock-card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .dark .stock-card {
      background: #2c2c2c;
      box-shadow: 0 4px 6px rgba(255,255,255,0.1);
    }
    .stock-card:hover {
      transform: translateY(-5px);
    }
    .stock-card.alert-low {
      border-left: 5px solid #ff4d4d;
    }
    .stock-card.alert-high {
      border-left: 5px solid #4dff4d;
    }
    .stock-card h3 {
      margin: 0 0 10px;
      color: #007bff;
      font-size: 1.2em;
    }
    .dark .stock-card h3 { color: #00d4ff; }
    .stock-card p {
      margin: 5px 0;
      font-size: 0.95em;
    }
    .stock-card canvas {
      max-height: 100px;
      width: 100%;
    }
    .error {
      color: #ff4d4d;
      text-align: center;
      margin: 10px 0;
      font-size: 0.9em;
    }
    .theme-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      background: #333;
      padding: 8px 15px;
      font-size: 0.9em;
    }
    .dark .theme-toggle {
      background: #fff;
      color: #333;
    }
    /* Media Queries pour mobile */
    @media (max-width: 600px) {
      .input-container {
        flex-direction: column;
        align-items: center;
      }
      input, button {
        max-width: 100%;
      }
      .stock-container {
        grid-template-columns: 1fr; /* Une colonne sur mobile */
      }
      .stock-card {
        padding: 10px;
      }
      h1 {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>
  <h1>Dashboard Boursier</h1>
  <div class="input-container">
    <input id="symbol" placeholder="Symbole (ex. AAPL)" required>
    <input id="threshold1" type="number" step="0.01" placeholder="Seuil bas" required>
    <input id="threshold2" type="number" step="0.01" placeholder="Seuil haut" required>
    <button onclick="addStock()">Ajouter</button>
  </div>
  <button class="theme-toggle" onclick="toggleTheme()">Mode Sombre</button>
  <div id="error" class="error"></div>
  <div class="stock-container" id="stockContainer"></div>

  <script>
    const API_KEY = 'KP8PGQNTCCZSGQX5'; // Votre clé API
    let stocks = loadStocks();
    let priceHistory = {};

    function loadStocks() {
      return JSON.parse(localStorage.getItem('stocks')) || [];
    }

    function saveStocks() {
      localStorage.setItem('stocks', JSON.stringify(stocks));
    }

    async function getStockPrice(symbol) {
      try {
        const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`);
        const data = await response.json();
        if (data['Global Quote'] && data['Global Quote']['05. price']) {
          return parseFloat(data['Global Quote']['05. price']).toFixed(2);
        }
        throw new Error('Symbole invalide ou limite API atteinte');
      } catch (error) {
        showError(`Erreur pour ${symbol}: ${error.message}`);
        return null;
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      setTimeout(() => errorDiv.textContent = '', 5000);
    }

    function addStock() {
      const symbol = document.getElementById('symbol').value.toUpperCase();
      const threshold1 = parseFloat(document.getElementById('threshold1').value);
      const threshold2 = parseFloat(document.getElementById('threshold2').value);

      if (!symbol || isNaN(threshold1) || isNaN(threshold2)) {
        showError('Veuillez remplir tous les champs.');
        return;
      }

      if (stocks.some(stock => stock.symbol === symbol)) {
        showError('Ce symbole est déjà suivi.');
        return;
      }

      stocks.push({ symbol, threshold1, threshold2, price: 0 });
      priceHistory[symbol] = [];
      saveStocks();
      document.getElementById('symbol').value = '';
      document.getElementById('threshold1').value = '';
      document.getElementById('threshold2').value = '';
      updateDashboard();
    }

    function removeStock(symbol) {
      stocks = stocks.filter(stock => stock.symbol !== symbol);
      delete priceHistory[symbol];
      saveStocks();
      updateDashboard();
    }

    async function updateDashboard() {
      const container = document.getElementById('stockContainer');
      container.innerHTML = '';

      for (let stock of stocks) {
        const price = await getStockPrice(stock.symbol);
        if (price !== null) {
          stock.price = price;
          priceHistory[stock.symbol].push(price);
          if (priceHistory[stock.symbol].length > 10) priceHistory[stock.symbol].shift();
        }

        const card = document.createElement('div');
        card.className = 'stock-card';
        card.innerHTML = `
          <h3>${stock.symbol}</h3>
          <p>Prix: ${stock.price || 'N/A'} $</p>
          <p>Seuil bas: ${stock.threshold1} $</p>
          <p>Seuil haut: ${stock.threshold2} $</p>
          <canvas id="chart-${stock.symbol}"></canvas>
          <button onclick="removeStock('${stock.symbol}')">Supprimer</button>
        `;

        if (stock.price && parseFloat(stock.price) <= stock.threshold1) {
          card.classList.add('alert-low');
          playSound('low');
        } else if (stock.price && parseFloat(stock.price) >= stock.threshold2) {
          card.classList.add('alert-high');
          playSound('high');
        }

        container.appendChild(card);
        drawChart(stock.symbol);
      }
    }

    function drawChart(symbol) {
      const ctx = document.getElementById(`chart-${symbol}`).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: priceHistory[symbol].map((_, i) => i + 1),
          datasets: [{
            label: 'Prix',
            data: priceHistory[symbol],
            borderColor: '#007bff',
            fill: false,
          }]
        },
        options: { scales: { y: { beginAtZero: false } }, plugins: { legend: { display: false } } }
      });
    }

    function playSound(type) {
      const audio = new Audio(type === 'low' ? 'https://www.soundjay.com/buttons/beep-01a.mp3' : 'https://www.soundjay.com/buttons/beep-02.mp3');
      audio.play();
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

    setInterval(updateDashboard, 60000);
    updateDashboard();
  </script>
</body>
</html>
